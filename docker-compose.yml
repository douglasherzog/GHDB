services:
  ghdb:
    build: .
    image: ghdb-app:latest
    container_name: ghdb
    expose:
      - "8000"
    environment:
      GHDB_ENV: "production"
      GHDB_SECRET_KEY: "${GHDB_SECRET_KEY}"
      GHDB_ADMIN_USERNAME: "${GHDB_ADMIN_USERNAME:-admin}"
      GHDB_ADMIN_PASSWORD: "${GHDB_ADMIN_PASSWORD}"
      GHDB_SESSION_TTL_SECONDS: "${GHDB_SESSION_TTL_SECONDS:-604800}"
      GHDB_COOKIE_SECURE: "${GHDB_COOKIE_SECURE:-true}"
      GHDB_ENABLE_PROXY_HEADERS: "${GHDB_ENABLE_PROXY_HEADERS:-true}"
      GHDB_ALLOWED_HOSTS: "${GHDB_ALLOWED_HOSTS:-}"
    volumes:
      - /opt/ghdb/data:/app/ghdb_app/data
    restart: unless-stopped

  caddy:
    image: caddy:2
    container_name: ghdb-caddy
    ports:
      - "80:80"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    depends_on:
      - ghdb
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:
